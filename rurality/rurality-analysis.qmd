
# Prerequisites
```{r}
#| label: load libraries
library(tidyverse)
library(haven)
library(janitor)
```
# Basic Data Manipulation

```{r}
#| label: load the tracker file
trd_raw <- read_sas('data/hrs/xwave-tracker.sas7bdat') %>%
    select(HHID, PN, GENDER, HISPANIC, RACE, wgt20r=SWGTR) %>%
    clean_names("all_caps") %>%
    filter(WGT20 > 0)
```
```{r}
#| label: load the wills data
wd <- read_sas('data/h20sas/h20t_r.sas7bdat') %>%
    select(hhid=HHID, pn=PN, will_type=RT001) %>%
    filter(will_type %in% 1:5) %>%
    mutate(will_ind=ifelse(will_type %in% 1:3, 'Yes', 'No')) %>%
    drop_na()
```
```{r}
#| label: load Cross-Wave Census Region/Division and Mobility data
rd <- read_sas('data/HRSXRegion2020v9Final/hrsxregion20.sas7bdat') %>%
    select(hhid=HHID, pn=PN, region=REGION20, rurality=BEALE2023_20) %>% # only the 2020 survey
    filter(rurality %in% 1:3) %>%
    mutate(across(rurality, as_factor)) %>%
    mutate(across(rurality, ~recode(.x, '1'='Urban', '2'='Suburban', '3'='Rural'))) %>%
    drop_na() 
```

```{r}
#| label: demographics
dm <- read_sas('data/h20sas/h20b_r.sas7bdat') %>%
    select(hhid=HHID, pn=PN, race=RB091M)
```

```{r}
#| label: merge will and rurality data
dd <- rd %>%
    inner_join(wd, by=c('hhid', 'pn')) 
```

# Simple Visualization

```{r}
#| label: plot will type by rurality
dd %>%
    group_by(rurality, will_ind) %>%
    count() %>%
    ggplot(aes(x=rurality, y=n, fill=will_ind)) + 
    geom_bar(stat='identity', position='fill') 
```