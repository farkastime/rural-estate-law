
# Prerequisites
```{r}
#| label: load libraries
library(tidyverse)
library(haven)
library(janitor)
```
# Basic Data Manipulation

```{r}
#| label: load the Cross-Wave Tracker File 
trk <- read_sas('data/hrs/xwave-tracker.sas7bdat') %>%
    select(HHID, PN, GENDER, HISPANIC, RACE, wgt20r=SWGTR) %>%
    clean_names("all_caps") %>%
    filter(WGT20R > 0)
```
```{r}
#| label: load the Wills and Life Insurance Data
wil <- read_sas('data/hrs/core-2020/h20t_r.sas7bdat') %>%
    select(HHID, PN, will_type=RT001) %>%
    clean_names("all_caps") %>%
    filter(WILL_TYPE %in% 1:5) %>%
    mutate(WILL_IND=ifelse(WILL_TYPE %in% 1:3, 'Yes', 'No')) %>%
    drop_na()
```
```{r}
#| label: load Cross-Wave Census Region/Division and Mobility data
rur <- read_sas('data/hrs/xwave-mobility.sas7bdat') %>%
    select(HHID, PN, region=REGION20, rurality=BEALE2023_20) %>% # only the 2020 survey
    clean_names("all_caps") %>%
    filter(RURALITY %in% 1:3) %>%
    mutate(across(RURALITY, as_factor)) %>%
    mutate(across(RURALITY, ~recode(.x, '1'='Urban', '2'='Suburban', '3'='Rural'))) %>%
    drop_na() 
```

```{r}
#| label: merge will and rurality data
dd <- trk %>%
    inner_join(wil, by=c('HHID', 'PN')) %>%
    inner_join(rur, by=c('HHID', 'PN')) 
```

# Simple Visualization

```{r}
#| label: plot will type by rurality
dd %>%
    group_by(RURALITY, WILL_IND, REGION) %>%
    summarize(across(WGT20R, sum)) %>%
    ggplot(aes(x=RURALITY, y=WGT20R, fill=WILL_IND)) + 
    geom_bar(stat='identity', position='fill') +
    facet_wrap(~REGION)
```